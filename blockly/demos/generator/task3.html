<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link href="demo.css" rel="stylesheet">
  <title>Blockly Demo: Generating JavaScript</title>
  <script src="../../blockly_uncompressed.js"></script>
  <script src="../../blocks_compressed.js"></script>
  <script src="../../javascript_compressed.js"></script>
  <script src="../../python_compressed.js"></script>
  <script src="../../lua_compressed.js"></script>
  <script src="../../msg/js/en.js"></script>
  <script src="../../../Hamster/hamsters.js"></script>
  
  <link href="prism.css" rel="stylesheet" />
  
  <script src="test_block.js"></script>
  <style>
    body {
      background-color: #fff;
      font-family: sans-serif;
    }
    h1 {
      font-weight: normal;
      font-size: 140%;
    }
  </style>
</head>
<body>
<script src="prism.js"></script>
  <h1>Cinderly &gt;
    <a href="task1.html">Task 1</a> &gt; <a href="task2.html">Task 2</a> &gt;
    Task 3 &gt; <a href="https://auckland.au1.qualtrics.com/jfe/form/SV_06QRBbBhGWt5nVP"> Survey</a></h1>

  <p>This block is similar to the last, but instead of running a code snippet, it instead runs a function that is passed to it. <br>
  It will take in arguments to be passed to the function. Since we want to run this function more than once, you will need to pass a list of arguments. <br>
  Each time the function is called, one entry in each list is used. This means that the function will be called as many times as there are elements in the list. <br>
  <br>Try to use the operate_on_list function and the multiprocessing block to operate on arr_1, arr_2, and arr_3 all at once. <br>
  </p>

  <p>
        Show code: 
        <button onclick="showCode('language-python')">Python</button>
      <button disabled onclick="noCode()">JavaScript</button>
      <button disabled onclick="noCode()">PHP</button>
      <button onclick="showCode('language-lua')">Lua</button>
      <button disabled onclick="noCode()">Dart</button>&emsp;
	  
	  <button onclick="toggleSolution()">Show Solution</button>
        <!-- <button onclick="runCode()">Run JavaScript</button> -->
      </p>
  <img id="solution" src="task3.jpg" style="display:none;"></img>
  <div id="blocklyDiv" style="height: 80vh; width: 70vw; float: left"></div>

  <xml id="toolbox" style="display: none">
    
    <category name="Logic" colour="%{BKY_LOGIC_HUE}">
	    <block type="procedures_defnoreturn"></block>
      <block type="multiprocess"></block>
      <block type="multiprocess_snippet"></block>
      <block type="functions_get"></block>  
      <block type="variables_get"></block>
	  
      <block type="controls_if"></block>
      <block type="logic_compare"></block>
      <block type="logic_operation"></block>
      <block type="logic_negate"></block>
      <block type="logic_boolean"></block>
      <block type="logic_null"></block>
      <block type="logic_ternary"></block>
    </category>
    <category name="Loops" colour="%{BKY_LOOPS_HUE}">
      <block type="controls_repeat_ext">
        <value name="TIMES">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
      </block>
      <block type="controls_whileUntil"></block>
      <block type="controls_for">
        <value name="FROM">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="TO">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
        <value name="BY">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
      <block type="controls_forEach"></block>
      <block type="controls_flow_statements"></block>
    </category>
    <category name="Math" colour="%{BKY_MATH_HUE}">
      <block type="math_number">
        <field name="NUM">123</field>
      </block>
      <block type="math_arithmetic">
        <value name="A">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="B">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
      <block type="math_single">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">9</field>
          </shadow>
        </value>
      </block>
      <block type="math_trig">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">45</field>
          </shadow>
        </value>
      </block>
      <block type="math_constant"></block>
      <block type="math_number_property">
        <value name="NUMBER_TO_CHECK">
          <shadow type="math_number">
            <field name="NUM">0</field>
          </shadow>
        </value>
      </block>
      <block type="math_round">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">3.1</field>
          </shadow>
        </value>
      </block>
      <block type="math_on_list"></block>
      <block type="math_modulo">
        <value name="DIVIDEND">
          <shadow type="math_number">
            <field name="NUM">64</field>
          </shadow>
        </value>
        <value name="DIVISOR">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
      </block>
      <block type="math_constrain">
        <value name="VALUE">
          <shadow type="math_number">
            <field name="NUM">50</field>
          </shadow>
        </value>
        <value name="LOW">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="HIGH">
          <shadow type="math_number">
            <field name="NUM">100</field>
          </shadow>
        </value>
      </block>
      <block type="math_random_int">
        <value name="FROM">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="TO">
          <shadow type="math_number">
            <field name="NUM">100</field>
          </shadow>
        </value>
      </block>
      <block type="math_random_float"></block>
      <block type="math_atan2">
        <value name="X">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="Y">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
    </category>
    <category name="Text" colour="%{BKY_TEXTS_HUE}">
      <block type="text"></block>
      <block type="text_join"></block>
      <block type="text_append">
        <value name="TEXT">
          <shadow type="text"></shadow>
        </value>
      </block>
      <block type="text_length">
        <value name="VALUE">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_isEmpty">
        <value name="VALUE">
          <shadow type="text">
            <field name="TEXT"></field>
          </shadow>
        </value>
      </block>
      <block type="text_indexOf">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">{textVariable}</field>
          </block>
        </value>
        <value name="FIND">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_charAt">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">{textVariable}</field>
          </block>
        </value>
      </block>
      <block type="text_getSubstring">
        <value name="STRING">
          <block type="variables_get">
            <field name="VAR">{textVariable}</field>
          </block>
        </value>
      </block>
      <block type="text_changeCase">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_trim">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_print">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_prompt_ext">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
    </category>
    <category name="Lists" colour="%{BKY_LISTS_HUE}">
      <block type="lists_create_with">
        <mutation items="0"></mutation>
      </block>
      <block type="lists_create_with"></block>
      <block type="lists_repeat">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">5</field>
          </shadow>
        </value>
      </block>
      <block type="lists_length"></block>
      <block type="lists_isEmpty"></block>
      <block type="lists_indexOf">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">{listVariable}</field>
          </block>
        </value>
      </block>
      <block type="lists_getIndex">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">{listVariable}</field>
          </block>
        </value>
      </block>
      <block type="lists_setIndex">
        <value name="LIST">
          <block type="variables_get">
            <field name="VAR">{listVariable}</field>
          </block>
        </value>
      </block>
      <block type="lists_getSublist">
        <value name="LIST">
          <block type="variables_get">
            <field name="VAR">{listVariable}</field>
          </block>
        </value>
      </block>
      <block type="lists_split">
        <value name="DELIM">
          <shadow type="text">
            <field name="TEXT">,</field>
          </shadow>
        </value>
      </block>
      <block type="lists_sort"></block>
    </category>
    <sep></sep>
    <category name="Variables" colour="%{BKY_VARIABLES_HUE}" custom="VARIABLE"></category>
    <category name="Functions" colour="%{BKY_PROCEDURES_HUE}" custom="PROCEDURE"></category>
    <sep></sep>
	<category name="Parallel" colour="#db6a00">
      <block type="multiprocess">
		<value name="CORES">
		  <shadow type="math_number">
			<field name="NUM">4</field>
		  </shadow>
		</value>
		<value name="ITER">
		  <shadow type="math_number">
			<field name="NUM">100</field>
		  </shadow>
		</value>
    </block>
    <block type="functions_get"></block>
    </category>
	
  </xml>
  
  <xml id="startBlocks" style="display: none">
	<block id="ORIGIN_BLOCK" type="procedures_defreturn" id="v|@,.B[xG/A]%Gt5!Cr=" x="13" y="37">
    <mutation>
      <arg name="list" varid="XsL*UJVj{D,xFU}DlUF]"></arg>
      <arg name="operation" varid="3mFs;2r?vqUC[aAE8Zs7"></arg>
    </mutation>
    <field name="NAME">operate_on_list</field>
    <comment pinned="true" h="80" w="160">This function takes in a list of values, and a string to determine what operation is performed on all the list elements. Returns the total value after the operation has been applied to the list elements.</comment>
    <statement name="STACK">
      <block type="variables_set" id="MEoY{kG+9rvn*fB4=VZf">
        <field name="VAR" id="9VIiaU_E9Dsw)%|T+xU?" variabletype="">total</field>
        <value name="VALUE">
          <block type="math_number" id="p/0z/U$Ys=(,M^wEFF,o">
            <field name="NUM">0</field>
          </block>
        </value>
        <next>
          <block type="controls_if" id="kGy1dUm;[wHf$As1)^6)">
            <mutation else="1"></mutation>
            <value name="IF0">
              <block type="logic_compare" id="=_$G,oq0w*zQ|NKU$JSE">
                <field name="OP">EQ</field>
                <value name="A">
                  <block type="variables_get" id="q#1o1(+gD:kj{PEX(BCA">
                    <field name="VAR" id="3mFs;2r?vqUC[aAE8Zs7" variabletype="">operation</field>
                  </block>
                </value>
                <value name="B">
                  <block type="text" id="opBB$u3X*ben+|BnMxKh">
                    <field name="TEXT">add</field>
                  </block>
                </value>
              </block>
            </value>
            <statement name="DO0">
              <block type="controls_forEach" id="k+IK-qqJ!CdNw0uL]K^E">
                <field name="VAR" id="#JAtCcKvhpgqruTxvYAa" variabletype="">item</field>
                <value name="LIST">
                  <block type="variables_get" id="{ZcViALZ?0fZ/v|@ru)t">
                    <field name="VAR" id="XsL*UJVj{D,xFU}DlUF]" variabletype="">list</field>
                  </block>
                </value>
                <statement name="DO">
                  <block type="variables_set" id="$u$qI:R{azKrv3!r.NG6">
                    <field name="VAR" id="9VIiaU_E9Dsw)%|T+xU?" variabletype="">total</field>
                    <value name="VALUE">
                      <block type="math_arithmetic" id="A$/A$f~r{5JCRB_oXXYs">
                        <field name="OP">ADD</field>
                        <value name="A">
                          <block type="variables_get" id="I^vUSB0{a.{_z7n3BSes">
                            <field name="VAR" id="9VIiaU_E9Dsw)%|T+xU?" variabletype="">total</field>
                          </block>
                        </value>
                        <value name="B">
                          <block type="variables_get" id="}]Gqt@}@G0zK5BjoEqZ*">
                            <field name="VAR" id="#JAtCcKvhpgqruTxvYAa" variabletype="">item</field>
                          </block>
                        </value>
                      </block>
                    </value>
                  </block>
                </statement>
              </block>
            </statement>
            <statement name="ELSE">
              <block type="controls_forEach" id="gr8bwh]pmtY9%0EF@$^r">
                <field name="VAR" id="#JAtCcKvhpgqruTxvYAa" variabletype="">item</field>
                <value name="LIST">
                  <block type="variables_get" id="_cqK.iowqXVvO?#m=d|]">
                    <field name="VAR" id="XsL*UJVj{D,xFU}DlUF]" variabletype="">list</field>
                  </block>
                </value>
                <statement name="DO">
                  <block type="variables_set" id="C3QPh,Qw(qSUfBR4-NyY">
                    <field name="VAR" id="9VIiaU_E9Dsw)%|T+xU?" variabletype="">total</field>
                    <value name="VALUE">
                      <block type="math_arithmetic" id="}l}1U.=|9#i;yo8,C7x.">
                        <field name="OP">MULTIPLY</field>
                        <value name="A">
                          <block type="variables_get" id="`J_6U24X~KbwW)i7j{+B">
                            <field name="VAR" id="9VIiaU_E9Dsw)%|T+xU?" variabletype="">total</field>
                          </block>
                        </value>
                        <value name="B">
                          <block type="variables_get" id="LA1}{=FdEn)cM:;*?c(.">
                            <field name="VAR" id="#JAtCcKvhpgqruTxvYAa" variabletype="">item</field>
                          </block>
                        </value>
                      </block>
                    </value>
                  </block>
                </statement>
              </block>
            </statement>
          </block>
        </next>
      </block>
    </statement>
    <value name="RETURN">
      <block type="variables_get" id="R,*KIN;FFT/FZU!8..0G">
        <field name="VAR" id="9VIiaU_E9Dsw)%|T+xU?" variabletype="">total</field>
      </block>
    </value>
  </block>
	
	<block type="variables_set" id="WW-GF4o#T8)O{c2}DX}6" x="13" y="413">
    <field name="VAR" id="VphcXKm%j!ygv8Dm{5NS" variabletype="">arr_1</field>
    <value name="VALUE">
      <block type="lists_create_with" id="RuijAQonctlSePhs!rz$">
        <mutation items="3"></mutation>
        <value name="ADD0">
          <block type="math_number" id="8Ae,jM6ru?N.~6fUqD^X">
            <field name="NUM">0</field>
          </block>
        </value>
        <value name="ADD1">
          <block type="math_number" id="tK}*y,6rI^(u{pP+j){I">
            <field name="NUM">1</field>
          </block>
        </value>
        <value name="ADD2">
          <block type="math_number" id="_ns(*nyB_0)jlmq*{QIK">
            <field name="NUM">2</field>
          </block>
        </value>
      </block>
    </value>
    <next>
      <block type="variables_set" id="0IfuCUJ?Z,}1q]0PZ[aM">
        <field name="VAR" id="rNPH4+[klErvpp^B;.?}" variabletype="">arr_2</field>
        <value name="VALUE">
          <block type="lists_create_with" id="|Rnxasg:Q2i)xA^7wX[p">
            <mutation items="3"></mutation>
            <value name="ADD0">
              <block type="math_number" id="^3t%*.IPC1@%+wynq1h)">
                <field name="NUM">3</field>
              </block>
            </value>
            <value name="ADD1">
              <block type="math_number" id="@X1jr{[5H^LT0HGAdA{`">
                <field name="NUM">4</field>
              </block>
            </value>
            <value name="ADD2">
              <block type="math_number" id="XvSgQ0)mYX0No2Qd}L-W">
                <field name="NUM">5</field>
              </block>
            </value>
          </block>
        </value>
        <next>
          <block type="variables_set" id=",7u^Kd*!92[$B^f:rP3P">
            <field name="VAR" id="~.fPXE(y.GNcrsZX]~m~" variabletype="">arr_3</field>
            <value name="VALUE">
              <block type="lists_create_with" id="dLuS|t;Qz+PqzQXVf?3C">
                <mutation items="3"></mutation>
                <value name="ADD0">
                  <block type="math_number" id="/2nXj1.XE#%8BBKKEgVv">
                    <field name="NUM">6</field>
                  </block>
                </value>
                <value name="ADD1">
                  <block type="math_number" id="YF/e!9qr5Sleo7tfOW5z">
                    <field name="NUM">7</field>
                  </block>
                </value>
                <value name="ADD2">
                  <block type="math_number" id="h2J4Id@+[_`a;,ZMqG[e">
                    <field name="NUM">8</field>
                  </block>
                </value>
              </block>
            </value>
            <next>
              <block type="variables_set" id="EzbBMB.hrF3Xtom$LqRg">
                <field name="VAR" id="9U#wW.q{:FtTmM@I@10=" variabletype="">op1</field>
                <value name="VALUE">
                  <block type="text" id="3F@8j6?GIaKsRjZ/2sRI">
                    <field name="TEXT">add</field>
                  </block>
                </value>
                <next>
                  <block type="variables_set" id="rdkKfq8WVowc*@x`_2~X">
                    <field name="VAR" id="o1b/:L1.|MF94]oX~nix" variabletype="">op2</field>
                    <value name="VALUE">
                      <block type="text" id="NoF,!y8*C/ZG5*Be`TZ7">
                        <field name="TEXT">multiply</field>
                      </block>
                    </value>
                    <next>
                      <block type="variables_set" id="+5u(T7r?_Z)r8{N#WZ+J">
                        <field name="VAR" id="}Rs5VJuvEP!skQIx4EFH" variabletype="">op3</field>
                        <value name="VALUE">
                          <block type="text" id="M7At9.3fDmGh9eo$#?Im">
                            <field name="TEXT">multiply</field>
                          </block>
                        </value>
                      </block>
                    </next>
                  </block>
                </next>
              </block>
            </next>
          </block>
        </next>
      </block>
    </next>
  </block>
	
	<block type="text_print" id="*?04psq^#{Y$rONOaYem" x="400", y="400">
	<value name="TEXT">
		<block type="multiprocess">
			<value name="ITER">
			  <shadow type="math_number">
				<field name="NUM">100</field>
			  </shadow>
			</value>
			<value name="CORES">
			  <shadow type="math_number">
				<field name="NUM">3</field>
			  </shadow>
			</value>
		</block>
	</value>
	</block>
	<block type="functions_get" x="500", y="350"></block>
  </xml>
  
  <script>
    var demoWorkspace = Blockly.inject('blocklyDiv',
        {media: '../../media/',
         toolbox: document.getElementById('toolbox')});
    Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'),
                               demoWorkspace);
	PARALLEL_HUE = "#db6a00"
	demoWorkspace.addChangeListener(Blockly.FieldFunction.prototype.onFunctionRename);

    function showCode(lang) {
      // Generate JavaScript code and display it.
      Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
	  if (lang == 'language-python'){
	      var code = Blockly.Python.workspaceToCode(demoWorkspace);
	  }
	  else if (lang == 'language-lua'){
	      var code = Blockly.Lua.workspaceToCode(demoWorkspace);
	  }
      
      resetFunctionCounter()
      document.getElementById('code').textContent = code
	  document.getElementById('code').className = lang
	  Prism.highlightElement(document.getElementById('code'))
    }

    function noCode() {
      alert("Language not implemented yet");
    }
    
	function toggleSolution(){ 
	  if (document.getElementById('solution').style.display == 'none'){
		document.getElementById('solution').style.display = 'block'
	  }
	  else{
		document.getElementById('solution').style.display= 'none';
	  }
	}
	
    function runCode() {
      // Generate JavaScript code and run it.
      window.LoopTrap = 1000;
      Blockly.JavaScript.INFINITE_LOOP_TRAP =
          'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
      var code = Blockly.JavaScript.workspaceToCode(demoWorkspace);
      Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
      try {
        eval(code);
      } catch (e) {
        alert(e);
      }
    }
  </script>
  <div dark-code="">Generated Code: 
    <pre><code id="code" class="language-python"></code></pre>
  </div>
  </body>
</html>
